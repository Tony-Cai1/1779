# Example Ingress configuration using nip.io (no domain required)
# This is perfect for development/testing
#
# How to use:
# 1. Get your Ingress LoadBalancer IP:
#    kubectl get svc -n ingress-nginx ingress-nginx-controller
# 2. Replace "157.230.69.194" below with your actual IP
# 3. Apply this file: kubectl apply -f ingress-nipio-example.yaml
#
# Access your services:
# - API: http://api.157.230.69.194.nip.io
# - Grafana: http://grafana.157.230.69.194.nip.io
# - Prometheus: http://prometheus.157.230.69.194.nip.io
# - ArgoCD: http://argocd.157.230.69.194.nip.io

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: lms-ingress
  namespace: default
  annotations:
    # NGINX Ingress Controller annotations
    # Note: SSL/TLS doesn't work with nip.io, so we use HTTP only
    # Rate limiting for API
    nginx.ingress.kubernetes.io/limit-rps: "100"
    # Enable CORS for API (if needed)
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-origin: "*"
    # WebSocket support for ArgoCD and API
    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
spec:
  ingressClassName: nginx
  # No TLS section - nip.io doesn't support SSL certificates
  rules:
  # LMS API
  # Replace 157.230.69.194 with your Ingress LoadBalancer IP
  - host: api.157.230.69.194.nip.io
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: lms-api-service
            port:
              number: 80
  
  # Grafana Dashboards
  - host: grafana.157.230.69.194.nip.io
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: grafana-service
            port:
              number: 3000
  
  # Prometheus (optional - consider keeping internal)
  - host: prometheus.157.230.69.194.nip.io
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: prometheus-service
            port:
              number: 9090
  
  # ArgoCD - Note: ArgoCD service is in 'argocd' namespace
  # Use separate ingress: kubectl apply -f k8s/argocd-ingress.yaml
  # - host: argocd.157.230.69.194.nip.io
  #   http:
  #     paths:
  #     - path: /
  #       pathType: Prefix
  #       backend:
  #         service:
  #           name: argocd-server
  #           port:
  #             number: 80

